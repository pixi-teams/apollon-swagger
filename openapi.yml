openapi: 3.0.3
info:
  title: Apollon API
  description: |
    Apollon 顧客管理サービスのAPI仕様書です。
    このドキュメントは、Web予約システムとキャスト向け管理機能のエンドポイントを定義します。
  version: 2.0.0
  contact:
    name: API Support
    email: support@example.com
servers:
  - url: http://localhost:8080/v1
    description: 開発環境サーバー
  - url: https://api.apollon.example.com/v1
    description: 本番環境サーバー
tags:
  - name: Web
    description: Web予約システム向けAPI
  - name: Cast
    description: キャスト専用API
  - name: Admin
    description: 管理者・スタッフ専用API
  - name: Notification
    description: 通知機能API
paths:
  /auth/login:
    post:
      tags:
        - Cast
      summary: キャストログイン
      description: メールアドレスまたはキャストIDを使用してログインします。
      operationId: castLogin
      requestBody:
        $ref: '#/components/requestBodies/CastLoginRequest'
      responses:
        '200':
          description: ログイン成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CastLoginResponse'
        default:
          $ref: '#/components/responses/DefaultError'
  /auth/logout:
    post:
      tags:
        - Cast
      summary: ログアウト
      description: ユーザー（キャスト）をログアウトさせます。
      security:
        - BearerAuth: []
      requestBody:
        $ref: '#/components/requestBodies/LogoutRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        default:
          $ref: '#/components/responses/DefaultError'
  /auth/me:
    get:
      tags:
        - Cast
      summary: ユーザー情報取得
      description: ログイン中のユーザー（キャスト）の情報を取得します。
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthMeResponse'
        default:
          $ref: '#/components/responses/DefaultError'
  /auth/reset-password:
    post:
      tags:
        - Cast
      summary: パスワードリセット
      description: パスワードリセット用のメールを送信します。
      requestBody:
        $ref: '#/components/requestBodies/ResetPasswordRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        default:
          $ref: '#/components/responses/DefaultError'
  /auth/oauth/start:
    get:
      tags:
        - Auth
      summary: OAuth認証開始
      description: 指定されたプロバイダ（Google, Apple）でのOAuth認証を開始するためのURLを取得します。
      operationId: getAuthOauthStart
      parameters:
        - name: provider
          in: query
          description: 認証プロバイダ (google, apple)
          required: true
          schema:
            type: string
            enum: [google, apple]
        - name: storeId
          in: query
          description: 店舗ID (オプション)
          required: false
          schema:
            type: string
      responses:
        '200':
          description: 認証URL取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    description: 認証用リダイレクトURL
        default:
          $ref: '#/components/responses/DefaultError'
  /auth/oauth/callback:
    get:
      tags:
        - Auth
      summary: OAuthコールバック
      description: OAuthプロバイダからのコールバックを受け付け、フロントエンドへリダイレクトします。
      operationId: getAuthOauthCallback
      parameters:
        - name: code
          in: query
          description: 認証コード
          required: true
          schema:
            type: string
        - name: state
          in: query
          description: 状態トークン
          required: true
          schema:
            type: string
      responses:
        '302':
          description: フロントエンドへのリダイレクト
        default:
          $ref: '#/components/responses/DefaultError'
  /auth/exchange:
    post:
      tags:
        - Auth
      summary: トークン交換
      description: ワンタイムコードを使用してアクセストークンを取得します。
      operationId: postAuthExchange
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  description: ワンタイムコード
              required:
                - code
      responses:
        '200':
          description: トークン取得成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OAuthTokenResponse'
        default:
          $ref: '#/components/responses/DefaultError'
  /casts/{castId}/mypage:
    get:
      tags:
        - Cast
      summary: マイページ情報取得
      description: ログインしているキャストのマイページ情報を取得します。
      operationId: getCastMypage
      parameters:
        - $ref: '#/components/parameters/CastIdPath'
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 正常系レスポンス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CastMypage'
        '401':
          description: トークン無効
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: キャストが存在しない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/DefaultError'
  /casts/{castId}/todays-shift:
    get:
      tags:
        - Cast
      summary: 今日の出勤情報取得
      description: ログインしているキャストの今日の出勤情報を取得します。
      operationId: getTodaysShift
      parameters:
        - $ref: '#/components/parameters/CastIdPath'
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 正常系レスポンス。休みの場合、bodyはnullになります。
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodaysShift'
        default:
          $ref: '#/components/responses/DefaultError'
  /casts/{castId}/todays-reservations:
    get:
      tags:
        - Cast
      summary: 今日の予約情報取得
      description: ログインしているキャストの今日の予約情報を取得します。
      operationId: getTodaysReservations
      parameters:
        - $ref: '#/components/parameters/CastIdPath'
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 正常系レスポンス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodaysReservations'
        default:
          $ref: '#/components/responses/DefaultError'
  /casts/{castId}/sales-summary:
    get:
      tags:
        - Cast
      summary: 売上サマリ取得
      description: ログインしているキャストの売上サマリを取得します。
      operationId: getSalesSummary
      parameters:
        - $ref: '#/components/parameters/CastIdPath'
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 正常系レスポンス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SalesSummary'
        default:
          $ref: '#/components/responses/DefaultError'
  /casts/{castId}/reservation-form:
    get:
      tags:
        - Cast
      summary: 予約項目取得
      description: 予約フォームに必要な項目や選択肢のリストを取得します。
      operationId: getReservationForm
      parameters:
        - $ref: '#/components/parameters/CastIdPath'
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReservationForm'
        default:
          $ref: '#/components/responses/DefaultError'
  /casts/{castId}/reservations:
    get:
      tags:
        - Cast
      summary: 予約情報一覧取得
      description: 指定された期間の予約情報の一覧を取得します。
      operationId: getReservationList
      parameters:
        - $ref: '#/components/parameters/CastIdPath'
        - $ref: '#/components/parameters/StartDateQuery'
        - $ref: '#/components/parameters/EndDateQuery'
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 正常系レスポンス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReservationSummaryList'
        default:
          $ref: '#/components/responses/DefaultError'
    post:
      tags:
        - Cast
      summary: 予約情報送信
      description: キャストが予約情報を登録または更新します。
      operationId: createOrUpdateReservation
      parameters:
        - $ref: '#/components/parameters/CastIdPath'
      security:
        - BearerAuth: []
      requestBody:
        $ref: '#/components/requestBodies/CastReservation'
      responses:
        '201':
          description: 予約成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreatedCastReservationResponse'
        default:
          $ref: '#/components/responses/DefaultError'
  /casts/{castId}/reservations/{reservationId}:
    put:
      tags:
        - Cast
      summary: 予約情報編集
      description: キャストが既存の予約情報を編集します。
      operationId: updateReservation
      parameters:
        - $ref: '#/components/parameters/CastIdPath'
        - $ref: '#/components/parameters/ReservationIdPath'
      security:
        - BearerAuth: []
      requestBody:
        $ref: '#/components/requestBodies/CastReservation'
      responses:
        '200':
          description: 編集成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdatedCastReservationResponse'
        '404':
          description: 予約が存在しない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/DefaultError'
  /casts/{castId}/customers:
    get:
      tags:
        - Cast
      summary: 顧客一覧取得
      description: キャストに紐づく顧客の一覧を取得します。
      operationId: getCustomerList
      parameters:
        - $ref: '#/components/parameters/CastIdPath'
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 正常系レスポンス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerSummaryList'
        default:
          $ref: '#/components/responses/DefaultError'
  /casts/{castId}/customers/{customerId}:
    get:
      tags:
        - Cast
      summary: 顧客詳細情報取得
      description: 指定された顧客の詳細情報を取得します。
      operationId: getCustomerDetail
      parameters:
        - $ref: '#/components/parameters/CastIdPath'
        - $ref: '#/components/parameters/CustomerIdPath'
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 正常系レスポンス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CustomerDetail'
        default:
          $ref: '#/components/responses/DefaultError'
  /casts/{castId}/customers/{customerId}/visits:
    get:
      tags:
        - Cast
      summary: 来店履歴取得
      description: 指定された顧客の来店履歴を取得します。
      operationId: getVisitHistory
      parameters:
        - $ref: '#/components/parameters/CastIdPath'
        - $ref: '#/components/parameters/CustomerIdPath'
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 正常系レスポンス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VisitHistoryList'
        default:
          $ref: '#/components/responses/DefaultError'
  /casts/report:
    get:
      tags:
        - Cast
      summary: 給与レポート取得
      description: ログインしているキャストの給与レポート（売上情報）を取得します。startDate/endDateが無い場合は当月の売上として集計します。
      operationId: getSalesReport
      parameters:
        - name: startDate
          in: query
          description: 任意期間の開始日（YYYY-MM-DD）
          required: false
          schema:
            type: string
            format: date
            example: '2025-11-01'
        - name: endDate
          in: query
          description: 任意期間の終了日（YYYY-MM-DD）
          required: false
          schema:
            type: string
            format: date
            example: '2025-11-30'
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 正常系レスポンス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SalesReportResponse'
        default:
          $ref: '#/components/responses/DefaultError'
  /web/shops/{shopId}/attendance-casts:
    get:
      tags:
        - Web
      summary: アテンダンスキャスト一覧取得
      description: 指定された店舗と日付における出勤キャストの一覧を取得します。
      parameters:
        - $ref: '#/components/parameters/ShopIdPath'
        - $ref: '#/components/parameters/DateQuery'
      responses:
        '200':
          $ref: '#/components/responses/AttendanceCastList'
        default:
          $ref: '#/components/responses/DefaultError'
  /web/shops/{shopId}:
    get:
      tags:
        - Web
      summary: 店舗情報取得
      description: 指定したIDの店舗情報を取得します。
      parameters:
        - $ref: '#/components/parameters/ShopIdPath'
      responses:
        '200':
          $ref: '#/components/responses/StoreSummary'
        default:
          $ref: '#/components/responses/DefaultError'
  /web/shops/{shopId}/prices:
    get:
      tags:
        - Web
      summary: 料金情報取得
      description: 指定した店舗の料金情報を取得します。
      parameters:
        - $ref: '#/components/parameters/ShopIdPath'
      responses:
        '200':
          $ref: '#/components/responses/PriceInfo'
        default:
          $ref: '#/components/responses/DefaultError'
  /web/casts/{castId}:
    get:
      tags:
        - Web
      summary: キャスト情報詳細取得
      description: 指定したIDのキャストの詳細情報を取得します。
      parameters:
        - $ref: '#/components/parameters/CastIdPath'
      responses:
        '200':
          $ref: '#/components/responses/CastDetail'
        default:
          $ref: '#/components/responses/DefaultError'
  /web/reservations:
    post:
      tags:
        - Web
      summary: Web予約フォーム送信
      description: 顧客がWeb予約フォームから予約情報を送信します。
      requestBody:
        $ref: '#/components/requestBodies/WebReservation'
      responses:
        '201':
          description: 予約成功
        default:
          $ref: '#/components/responses/DefaultError'
  /notifications:
    get:
      tags:
        - Notification
      summary: 通知一覧取得
      description: ログインユーザーの通知一覧を取得します。
      operationId: getNotifications
      parameters:
        - name: limit
          in: query
          description: '取得件数（デフォルト: 20, 最大: 50）'
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 50
            example: 20
        - name: offset
          in: query
          description: 'オフセット（デフォルト: 0）'
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
            example: 0
        - name: is_read
          in: query
          description: '未読/既読フィルタ（未指定の場合は全件）'
          required: false
          schema:
            type: boolean
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 正常系レスポンス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationListResponse'
        default:
          $ref: '#/components/responses/DefaultError'
  /notifications/unread-count:
    get:
      tags:
        - Notification
      summary: 未読件数取得
      description: ログインユーザーの未読通知件数を取得します。
      operationId: getUnreadCount
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 正常系レスポンス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UnreadCountResponse'
        default:
          $ref: '#/components/responses/DefaultError'
  /notifications/read-all:
    patch:
      tags:
        - Notification
      summary: 一括既読化
      description: ログインユーザーの未読通知をすべて既読にします。
      operationId: readAllNotifications
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 正常系レスポンス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReadAllResponse'
        default:
          $ref: '#/components/responses/DefaultError'
  /notifications/{notificationId}/read:
    patch:
      tags:
        - Notification
      summary: 通知既読化
      description: 指定された通知を既読にします。
      operationId: readNotification
      parameters:
        - $ref: '#/components/parameters/NotificationIdPath'
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 正常系レスポンス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationReadResponse'
        '404':
          description: 通知が存在しない、または自分の通知ではない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/DefaultError'
  /push/subscribe:
    post:
      tags:
        - Notification
      summary: Push通知サブスクリプション登録
      description: Push通知を受信するためのサブスクリプションを登録します。
      operationId: pushSubscribe
      security:
        - BearerAuth: []
      requestBody:
        $ref: '#/components/requestBodies/PushSubscriptionRequest'
      responses:
        '200':
          description: 正常系レスポンス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PushSubscribeResponse'
        default:
          $ref: '#/components/responses/DefaultError'
  /push/unsubscribe:
    delete:
      tags:
        - Notification
      summary: Push通知サブスクリプション解除
      description: Push通知のサブスクリプションを解除します。
      operationId: pushUnsubscribe
      parameters:
        - name: endpoint
          in: query
          description: 解除するエンドポイントURL
          required: true
          schema:
            type: string
            example: 'https://fcm.googleapis.com/fcm/send/xxxxxx'
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 正常系レスポンス
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PushUnsubscribeResponse'
        '404':
          description: サブスクリプションが存在しない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/DefaultError'
  /admin/auth/login:
    post:
      tags:
        - Admin
      summary: 管理者・スタッフログイン
      description: メールアドレスまたはスタッフIDを使用して管理者・スタッフがログインします。
      operationId: adminLogin
      requestBody:
        $ref: '#/components/requestBodies/AdminLoginRequest'
      responses:
        '200':
          description: ログイン成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminLoginResponse'
        '400':
          description: リクエスト不正
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: パスワード不一致
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: ユーザーが存在しない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/DefaultError'
  /admin/auth/oauth/start:
    get:
      tags:
        - Admin
      summary: 管理者・スタッフOAuth認証開始
      description: 指定されたプロバイダ（Google, Apple）でのOAuth認証を開始するためのURLを取得します。
      operationId: getAdminAuthOauthStart
      parameters:
        - name: provider
          in: query
          description: 認証プロバイダ (google, apple)
          required: true
          schema:
            type: string
            enum: [google, apple]
        - name: storeId
          in: query
          description: 店舗ID
          required: false
          schema:
            type: string
      responses:
        '200':
          description: 認証URL取得成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  authUrl:
                    type: string
                    description: 認証用リダイレクトURL
        default:
          $ref: '#/components/responses/DefaultError'
  /admin/auth/oauth/callback:
    get:
      tags:
        - Admin
      summary: 管理者・スタッフOAuthコールバック
      description: OAuthプロバイダからのコールバックを受け付け、フロントエンドへリダイレクトします。
      operationId: getAdminAuthOauthCallback
      parameters:
        - name: code
          in: query
          description: 認証コード
          required: true
          schema:
            type: string
        - name: state
          in: query
          description: CSRF防止用のstateパラメータ
          required: true
          schema:
            type: string
      responses:
        '302':
          description: フロントエンドへのリダイレクト
        default:
          $ref: '#/components/responses/DefaultError'
  /admin/auth/oauth/token:
    post:
      tags:
        - Admin
      summary: 管理者・スタッフトークン交換
      description: コールバックで取得した認証コードを使用してアクセストークンを取得します。
      operationId: postAdminAuthOauthToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  description: コールバックで取得した認証コード
                storeId:
                  type: string
                  description: 店舗ID
              required:
                - code
                - storeId
      responses:
        '200':
          description: トークン取得成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminOAuthTokenResponse'
        '400':
          description: 認証コード不正
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: ユーザーが存在しない
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        default:
          $ref: '#/components/responses/DefaultError'
components:
  schemas:
    AuthMeResponse:
      type: object
      properties:
        isSuccess:
          type: boolean
          description: 成功フラグ
          example: true
        userId:
          type: string
          description: Supabase Auth のユーザーID
          example: 'ae93f1c2-xxxx-xxxx-xxxx-f0e85c4dd111'
        storeId:
          type: string
          description: 店舗ID
          example: '1001'
        castId:
          type: string
          description: キャストID
          example: 'cst-00123'
        emailAddress:
          type: string
          description: メールアドレス（Auth プロバイダから取得）
          nullable: true
          example: 'test@example.com'
        authProvider:
          type: string
          description: '`email` / `google` / `apple`'
          enum:
            - email
            - google
            - apple
          example: 'email'
      required:
        - isSuccess
        - userId
        - storeId
        - castId
        - authProvider
    CastMypage:
      type: object
      description: キャストマイページ情報
      properties:
        castId:
          type: string
          description: キャストID
          example: 'cst-00001'
        stageName:
          type: string
          description: 源氏名
          example: 'アリス'
        imageUrl:
          type: string
          description: プロフィール画像URL
          example: 'https://example.com/alice.jpg'
        description:
          type: string
          description: 店舗からのキャスト紹介文
          example: '新人セラピストのアリスです。癒やしの時間を提供します。'
        height:
          type: number
          description: 身長(cm)
          nullable: true
          example: 160
        bust:
          type: number
          description: バスト(cm)
          nullable: true
          example: 85
        waist:
          type: number
          description: ウエスト(cm)
          nullable: true
          example: 58
        hip:
          type: number
          description: ヒップ(cm)
          nullable: true
          example: 86
        shopName:
          type: string
          description: 所属店舗名
          example: 'Apollon Ginza'
      required:
        - castId
        - stageName
        - imageUrl
        - description
        - shopName
    LogoutRequest:
      type: object
      properties:
        accessToken:
          type: string
          description: JWT アクセストークン
        refreshToken:
          type: string
          description: リフレッシュトークン
      required:
        - accessToken
        - refreshToken
    SuccessResponse:
      type: object
      properties:
        isSuccess:
          type: boolean
          description: 成功フラグ
          example: true
      required:
        - isSuccess
    CastLoginRequest:
      type: object
      description: キャストログインリクエスト
      properties:
        storeId:
          type: string
          description: 店舗ID
          example: '1001'
        emailAddress:
          type: string
          description: メールアドレス
          example: 'test@example.com'
        castId:
          type: string
          description: キャストID
          example: 'cst-00032'
        password:
          type: string
          description: パスワード
          example: 'abc12345'
      required:
        - storeId
        - password
      oneOf:
        - required:
            - emailAddress
        - required:
            - castId
    CastLoginResponse:
      type: object
      description: キャストログインレスポンス
      properties:
        isSuccess:
          type: boolean
          description: ログイン成功フラグ
          example: true
        accessToken:
          type: string
          description: アクセストークン（JWT）
          example: xxxxx.yyyyy.zzzzz
        refreshToken:
          type: string
          description: リフレッシュトークン
          example: rrrrr.sssss.ttttt
        userId:
          type: string
          description: Supabase Auth のユーザーID
          example: a1b2c3d4e5
        storeId:
          type: string
          description: 店舗ID
          example: '1001'
        castId:
          type: string
          description: キャストID
          example: 'cst-00123'
        castName:
          type: string
          description: キャスト名
          example: 'キャストA'
      required:
        - isSuccess
        - accessToken
        - refreshToken
        - userId
        - storeId
        - castId
        - castName
    ResetPasswordRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          description: '登録されているメールアドレス'
      required:
        - email
    TodaysShift:
      type: object
      properties:
        startTime:
          type: string
          format: date-time
          description: 出勤開始時刻
        endTime:
          type: string
          format: date-time
          description: 出勤終了時刻
        status:
          type: string
          description: 出勤ステータス（"通常" / "遅番" など）
          example: 通常出勤
      nullable: true
      description: キャストの今日の出勤情報。休みの場合、このオブジェクトはnullになります。
    ReservationToday:
      $ref: './components/models/cast/ReservationToday.yaml'
    TodaysReservations:
      type: object
      properties:
        count:
          type: integer
          format: int32
          description: 本日の予約件数
          example: 3
        reservations:
          type: array
          items:
            $ref: '#/components/schemas/ReservationToday'
      description: 今日の予約一覧のレスポンス。
      required:
        - count
        - reservations
    SalesSummaryItem:
      $ref: './components/models/cast/SalesSummaryItem.yaml'
    SalesSummary:
      type: object
      properties:
        today:
          $ref: '#/components/schemas/SalesSummaryItem'
        thisWeek:
          $ref: '#/components/schemas/SalesSummaryItem'
        thisMonth:
          $ref: '#/components/schemas/SalesSummaryItem'
      description: 売上サマリ全体のレスポンス。
      required:
        - today
        - thisWeek
        - thisMonth
    ReservationForm:
      $ref: './components/results/cast/ReservationForm.yaml'
    CastReservation:
      type: object
      properties:
        store_id:
          type: string
          description: 店舗ID
          example: '1'
        cast_id:
          type: string
          description: キャストID（ログイン済みでも送信）
          example: '12'
        reservation_datetime:
          type: string
          format: date-time
          description: 予約日時（ISO8601形式）
          example: '2025-11-15T20:00:00+09:00'
        shimei_type:
          type: string
          description: 指名種別
          enum: [photo, regular]
          example: 'photo'
        extension:
          type: string
          description: 延長時間
          enum: ['30', '60', '90']
          nullable: true
          example: '60'
        discount:
          type: string
          description: 店舗割引（店舗設定に応じる）
          nullable: true
          example: 'A'
        payment_method:
          type: string
          description: 支払い方法
          enum: [unknown, cash, card]
          example: 'cash'
        reservation_method:
          type: string
          description: 予約方法
          enum: [line, x, instagram, other]
          example: 'line'
        reservation_status:
          type: string
          description: ステータス
          enum: [new, draft]
          example: 'new'
        advertisement:
          type: array
          items:
            type: string
          description: 広告媒体（複数選択可）
          example: ['x', 'instagram']
        treatment_note:
          type: string
          description: 施術メモ
          nullable: true
          example: 'いい人'
        request:
          type: string
          description: ご要望
          nullable: true
          example: '静かに過ごしたい'
      required:
        - store_id
        - cast_id
        - reservation_datetime
        - shimei_type
        - payment_method
        - reservation_method
        - reservation_status
        - advertisement
    CreatedCastReservationResponse:
      $ref: './components/results/cast/CreatedCastReservationResponse.yaml'
    UpdatedCastReservationResponse:
      $ref: './components/results/cast/UpdatedCastReservationResponse.yaml'
    UpdatedCastReservation:
      $ref: './components/results/cast/UpdatedCastReservation.yaml'
    ReservationSummary:
      type: object
      properties:
        reservationId:
          type: string
        customerName:
          type: string
        reservationTime:
          type: string
          format: date-time
        course:
          type: string
        totalFee:
          type: integer
        status:
          type: string
        roomName:
          type: string
          nullable: true
          description: ルーム名
        shimeiType:
          type: string
          enum: [none, honshimei, photo]
          description: 指名タイプ
        endTime:
          type: string
          format: date-time
          description: 予約終了時刻
      required:
        - reservationId
        - customerName
        - reservationTime
        - course
        - totalFee
        - status
        - shimeiType
        - endTime
    ReservationSummaryList:
      type: object
      properties:
        reservations:
          type: array
          items:
            $ref: '#/components/schemas/ReservationSummary'
    CustomerSummary:
      type: object
      properties:
        customerId:
          type: string
        name:
          type: string
        lastVisitDate:
          type: string
          format: date
        visitCount:
          type: integer
      required:
        - customerId
        - name
        - lastVisitDate
        - visitCount
    CustomerSummaryList:
      type: object
      properties:
        customers:
          type: array
          items:
            $ref: '#/components/schemas/CustomerSummary'
    CustomerDetail:
      type: object
      properties:
        customerId:
          type: string
        name:
          type: string
        kana:
          type: string
        phone:
          type: string
        email:
          type: string
          format: email
        firstVisitDate:
          type: string
          format: date
        lastVisitDate:
          type: string
          format: date
        visitCount:
          type: integer
        notes:
          type: string
      required:
        - customerId
        - name
        - kana
        - firstVisitDate
        - lastVisitDate
        - visitCount
    VisitHistory:
      type: object
      properties:
        visitDate:
          type: string
          format: date
        course:
          type: string
        totalFee:
          type: integer
        notes:
          type: string
      required:
        - visitDate
        - course
        - totalFee
    VisitHistoryList:
      type: object
      properties:
        visits:
          type: array
          items:
            $ref: '#/components/schemas/VisitHistory'
    SalesReportResponse:
      type: object
      description: 給与レポートレスポンス
      properties:
        todaySales:
          type: number
          description: 今日の売上
          example: 32000
        lastSales:
          type: number
          description: 前回の売上（前営業日 or 前シフト日）
          example: 28000
        lastWeekSales:
          type: number
          description: 先週の売上
          example: 160000
        thisMonthSales:
          type: number
          description: 今月の売上
          example: 540000
        periodSales:
          type: number
          description: 任意期間の売上（startDate/endDate 指定時）
          nullable: true
          example: 120000
      required:
        - todaySales
        - lastSales
        - lastWeekSales
        - thisMonthSales
    AttendanceCast:
      $ref: './components/results/web/AttendanceCast.yaml'
    StoreSummary:
      type: object
      description: 店舗サマリー情報
      properties:
        name:
          type: string
          description: 店舗名
          example: 'Apollon 銀座店'
        catch_phrase:
          type: string
          description: キャッチフレーズ
          example: '最高の癒しをお届けします'
        description:
          type: string
          description: 店舗詳細説明
          example: '銀座の中心にある落ち着いた雰囲気のサロンです。'
        address:
          type: string
          description: 店舗住所
          example: '東京都中央区銀座1-1-1'
        access:
          type: string
          description: アクセス情報
          example: '銀座駅A1出口より徒歩3分'
        business_hours:
          type: string
          description: 営業時間
          example: '18:00 - 26:00'
        phone_number:
          type: string
          description: 電話番号
          example: '03-1234-5678'
        line_id:
          type: string
          description: LINE ID
          example: '@apollon_ginza'
      required:
        - name
        - catch_phrase
        - description
        - address
        - access
        - business_hours
        - phone_number
        - line_id
    PriceInfo:
      $ref: './components/results/web/PriceInfo.yaml'
    CastDetail:
      $ref: './components/results/web/CastDetail.yaml'
    WebReservation:
      type: object
      properties:
        customer_name:
          type: string
          description: お客様の名前
          example: '山田 太郎'
        phone_number:
          type: string
          description: 電話番号
          example: '090-1234-5678'
        email:
          type: string
          format: email
          description: メールアドレス
          example: 'taro.yamada@example.com'
        requests:
          type: string
          description: ご要望
          example: '特にありません'
        reservation_datetime:
          type: string
          format: date-time
          description: 予約日時
          example: '2025-10-26T19:00:00+09:00'
        cast_name:
          type: string
          description: 指名キャスト名
          example: 'さくら'
        course:
          type: string
          description: コース
          example: 'リフレクソロジー60分'
        options:
          type: array
          items:
            type: string
          description: オプション
          example: ['延長10分', 'アロマオイル']
        total_fee:
          type: integer
          description: 合計料金
          example: 8000
    Notification:
      $ref: './components/models/notification/Notification.yaml'
    NotificationListResponse:
      $ref: './components/results/notification/NotificationListResponse.yaml'
    UnreadCountResponse:
      $ref: './components/results/notification/UnreadCountResponse.yaml'
    NotificationReadResponse:
      $ref: './components/results/notification/NotificationReadResponse.yaml'
    ReadAllResponse:
      $ref: './components/results/notification/ReadAllResponse.yaml'
    PushSubscriptionRequest:
      $ref: './components/models/notification/PushSubscriptionRequest.yaml'
    PushSubscribeResponse:
      $ref: './components/results/notification/PushSubscribeResponse.yaml'
    PushUnsubscribeResponse:
      $ref: './components/results/notification/PushUnsubscribeResponse.yaml'
    OAuthTokenResponse:
      type: object
      description: OAuth認証トークンレスポンス
      properties:
        accessToken:
          type: string
          description: Supabaseアクセストークン
        refreshToken:
          type: string
          description: Supabaseリフレッシュトークン
        expiresIn:
          type: integer
          description: トークンの有効期限（秒）
        castId:
          type: string
          description: キャストID
        storeId:
          type: string
          description: 店舗ID
      required:
        - accessToken
        - refreshToken
        - expiresIn
        - castId
        - storeId
    AdminLoginRequest:
      type: object
      description: 管理者・スタッフログインリクエスト
      properties:
        storeId:
          type: string
          description: 店舗ID
          example: '1001'
        emailAddress:
          type: string
          description: メールアドレス
          example: 'admin@example.com'
        staffId:
          type: string
          description: スタッフID
          example: 'stf-00123'
        password:
          type: string
          description: パスワード
          example: 'abc12345'
      required:
        - storeId
        - password
      oneOf:
        - required:
            - emailAddress
        - required:
            - staffId
    AdminLoginResponse:
      type: object
      description: 管理者・スタッフログインレスポンス
      properties:
        isSuccess:
          type: boolean
          description: ログイン成功フラグ
          example: true
        accessToken:
          type: string
          description: アクセストークン（JWT）
          example: xxxxx.yyyyy.zzzzz
        refreshToken:
          type: string
          description: リフレッシュトークン
          example: rrrrr.sssss.ttttt
        userId:
          type: string
          description: Supabase Auth のユーザーID
          example: a1b2c3d4e5
        storeId:
          type: string
          description: 店舗ID
          example: '1001'
        staffId:
          type: string
          description: スタッフID
          example: 'stf-00123'
        staffName:
          type: string
          description: スタッフ名
          example: '管理者A'
        role:
          type: string
          description: ロール
          enum: [admin, staff]
          example: 'admin'
      required:
        - isSuccess
        - accessToken
        - refreshToken
        - userId
        - storeId
        - staffId
        - staffName
        - role
    AdminOAuthTokenResponse:
      type: object
      description: 管理者・スタッフOAuth認証トークンレスポンス
      properties:
        isSuccess:
          type: boolean
          description: ログイン成功フラグ
          example: true
        accessToken:
          type: string
          description: アクセストークン（JWT）
          example: xxxxx.yyyyy.zzzzz
        refreshToken:
          type: string
          description: リフレッシュトークン
          example: rrrrr.sssss.ttttt
        userId:
          type: string
          description: Supabase Auth のユーザーID
          example: a1b2c3d4e5
        storeId:
          type: string
          description: 店舗ID
          example: '1001'
        staffId:
          type: string
          description: スタッフID
          example: 'stf-00123'
        staffName:
          type: string
          description: スタッフ名
          example: '管理者A'
        role:
          type: string
          description: ロール
          enum: [admin, staff]
          example: 'admin'
      required:
        - isSuccess
        - accessToken
        - refreshToken
        - userId
        - storeId
        - staffId
        - staffName
        - role
    Error:
      type: object
      properties:
        code:
          type: string
          description: エラーコード
          example: 'NOT_FOUND'
        message:
          type: string
          description: エラーメッセージ
          example: 'リソースが見つかりませんでした。'
      required:
        - code
        - message
  parameters:
    CastIdPath:
      name: castId
      in: path
      description: キャストID
      required: true
      schema:
        type: string
        example: 'cast001'
    ReservationIdPath:
      name: reservationId
      in: path
      description: 予約ID
      required: true
      schema:
        type: string
        example: 'res_98231'
    CustomerIdPath:
      name: customerId
      in: path
      description: '顧客ID'
      required: true
      schema:
        type: string
        example: 'cust_12345'
    PeriodQuery:
      name: period
      in: query
      description: '集計期間 (today, week, month)'
      required: true
      schema:
        type: string
        enum: [today, week, month]
        example: 'month'
    StartDateQuery:
      name: startDate
      in: query
      description: '取得開始日 (YYYY-MM-DD)'
      required: true
      schema:
        type: string
        format: date
        example: '2025-01-01'
    EndDateQuery:
      name: endDate
      in: query
      description: '取得終了日 (YYYY-MM-DD)'
      required: true
      schema:
        type: string
        format: date
        example: '2025-01-31'
    ShopIdPath:
      name: shopId
      in: path
      required: true
      description: 店舗ID
      schema:
        type: string
        example: '1014'
    DateQuery:
      name: date
      in: query
      required: true
      description: 日付 (YYYY-MM-DD)
      schema:
        type: string
        format: date
        example: '2025-10-22'
    NotificationIdPath:
      name: notificationId
      in: path
      description: 通知ID
      required: true
      schema:
        type: integer
        example: 123
  requestBodies:
    AdminLoginRequest:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AdminLoginRequest'
    CastLoginRequest:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CastLoginRequest'
    LogoutRequest:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/LogoutRequest'
    ResetPasswordRequest:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ResetPasswordRequest'
    CastReservation:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CastReservation'
    WebReservation:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/WebReservation'
    PushSubscriptionRequest:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/PushSubscriptionRequest'
  responses:
    AttendanceCastList:
      description: 成功
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: '#/components/schemas/AttendanceCast'
    StoreSummary:
      description: 成功
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/StoreSummary'
    PriceInfo:
      description: 成功
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/PriceInfo'
    CastDetail:
      description: 成功
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CastDetail'
    DefaultError:
      description: エラーレスポンス
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: '認証トークンを`Authorization`ヘッダーに`Bearer`スキーマで設定します。'
